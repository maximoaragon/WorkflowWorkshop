<ns0:BaseWorkflow x:Name="CloseReopenChargeWorkflow" InputParametersFormat="chargeID:System.Int32, reopenReason:System.String, reopenDate:System.DateTime" Initialized="BaseWorkflow_Initialized" ParameterValues="{x:Null}" Completed="BaseWorkflow_Completed" Case="{x:Null}" EnableCaseTransaction="False" InputParameters="{x:Null}" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/workflow" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:ns0="http://aptitudesolutions.com/ShowCaseWorkflowActivityLib">
	<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="GetCharge" MethodName="GetByID" Type="{x:Type p5:CCharges}" xmlns:p5="http://aptitudesolutions.com/ShowCaseClassLib">
		<ns0:CallMethodActivity.InstanceObject>
			<ActivityBind Name="CloseReopenChargeWorkflow" Path="Case.Charges" />
		</ns0:CallMethodActivity.InstanceObject>
		<ns0:CallMethodActivity.Parameters>
			<WorkflowParameterBinding ParameterName="piID">
				<WorkflowParameterBinding.Value>
					<ActivityBind Name="CloseReopenChargeWorkflow" Path="InputParameters.Item[0].ConvertToInteger" />
				</WorkflowParameterBinding.Value>
			</WorkflowParameterBinding>
		</ns0:CallMethodActivity.Parameters>
	</ns0:CallMethodActivity>
	<IfElseActivity x:Name="CheckChargeExists">
		<IfElseBranchActivity x:Name="ChargeExists">
			<IfElseBranchActivity.Condition>
				<RuleConditionReference ConditionName="ChargeExists" />
			</IfElseBranchActivity.Condition>
			<IfElseActivity x:Name="CheckValidReopenDate">
				<IfElseBranchActivity x:Name="ValidReopenDate" Description="ReopenDate &gt; Charge.DispositionDate">
					<IfElseBranchActivity.Condition>
						<RuleConditionReference ConditionName="ValidReopenDate" />
					</IfElseBranchActivity.Condition>
					<IfElseActivity x:Name="CheckActiveSameReasonReopens">
						<IfElseBranchActivity x:Name="ActiveSameReasonReopens" Description="Charge has no reopen records w/o populated ReopenCloseDates">
							<IfElseBranchActivity.Condition>
								<RuleConditionReference ConditionName="ActiveSameReasonReopens" />
							</IfElseBranchActivity.Condition>
							<ns0:CallMethodActivity ParameterTypes="System.String" x:Name="GetActiveReopens" MethodName="GetActiveReopen" Type="{x:Type p17:CCharge}" xmlns:p17="http://aptitudesolutions.com/ShowCaseClassLib">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="GetCharge" Path="ReturnParameter.ConvertToCCharge" />
								</ns0:CallMethodActivity.InstanceObject>
								<ns0:CallMethodActivity.Parameters>
									<WorkflowParameterBinding ParameterName="psReopenReason">
										<WorkflowParameterBinding.Value>
											<ActivityBind Name="CloseReopenChargeWorkflow" Path="InputParameters.Item[1].ConvertToString" />
										</WorkflowParameterBinding.Value>
									</WorkflowParameterBinding>
								</ns0:CallMethodActivity.Parameters>
							</ns0:CallMethodActivity>
							<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="GetActiveReopensEnumerator" MethodName="GetEnumerator" Type="{x:Type p17:Collection}" xmlns:p17="clr-namespace:Microsoft.VisualBasic;Assembly=Microsoft.VisualBasic, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="GetActiveReopens" Path="ReturnParameter.ConvertToCollection" />
								</ns0:CallMethodActivity.InstanceObject>
							</ns0:CallMethodActivity>
							<WhileActivity x:Name="WhileActiveReopens">
								<WhileActivity.Condition>
									<RuleConditionReference ConditionName="WhileActiveReopens" />
								</WhileActivity.Condition>
								<SequenceActivity x:Name="sequenceActivity1">
									<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="GetReopen" MethodName="get_Current" Type="{x:Type p21:IEnumerator}" xmlns:p21="clr-namespace:System.Collections;Assembly=mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
										<ns0:CallMethodActivity.InstanceObject>
											<ActivityBind Name="GetActiveReopensEnumerator" Path="ReturnParameter.Value" />
										</ns0:CallMethodActivity.InstanceObject>
									</ns0:CallMethodActivity>
									<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="CloseReopen" MethodName="Close" Type="{x:Type p21:CReopen}" xmlns:p21="http://aptitudesolutions.com/ShowCaseClassLib">
										<ns0:CallMethodActivity.InstanceObject>
											<ActivityBind Name="GetReopen" Path="ReturnParameter.ConvertToCReopen" />
										</ns0:CallMethodActivity.InstanceObject>
										<ns0:CallMethodActivity.Parameters>
											<WorkflowParameterBinding ParameterName="pdReopenCloseDate">
												<WorkflowParameterBinding.Value>
													<ActivityBind Name="CloseReopenChargeWorkflow" Path="InputParameters.Item[2].ConvertToDateTime" />
												</WorkflowParameterBinding.Value>
											</WorkflowParameterBinding>
										</ns0:CallMethodActivity.Parameters>
									</ns0:CallMethodActivity>
								</SequenceActivity>
							</WhileActivity>
							<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="UpdateReopen" MethodName="UpdateReopen" Description="Update the charge's ReopenReason and ReopenDate to reflect the most recent active reopen (if any)" Type="{x:Type p17:CCharge}" xmlns:p17="http://aptitudesolutions.com/ShowCaseClassLib">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="GetCharge" Path="ReturnParameter.ConvertToCCharge" />
								</ns0:CallMethodActivity.InstanceObject>
							</ns0:CallMethodActivity>
							<ns0:CallMethodActivity ParameterTypes="System.Boolean, System.Boolean" x:Name="SaveCharge" MethodName="Save" Type="{x:Type p17:CCharge}" xmlns:p17="http://aptitudesolutions.com/ShowCaseClassLib">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="GetCharge" Path="ReturnParameter.ConvertToCCharge" />
								</ns0:CallMethodActivity.InstanceObject>
								<ns0:CallMethodActivity.Parameters>
									<WorkflowParameterBinding ParameterName="pbSkipDocket">
										<WorkflowParameterBinding.Value>
											<ns4:Boolean xmlns:ns4="clr-namespace:System;Assembly=mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">true</ns4:Boolean>
										</WorkflowParameterBinding.Value>
									</WorkflowParameterBinding>
									<WorkflowParameterBinding ParameterName="pbSetCaseStatus">
										<WorkflowParameterBinding.Value>
											<ns4:Boolean xmlns:ns4="clr-namespace:System;Assembly=mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">false</ns4:Boolean>
										</WorkflowParameterBinding.Value>
									</WorkflowParameterBinding>
								</ns0:CallMethodActivity.Parameters>
							</ns0:CallMethodActivity>
							<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="SaveCase" MethodName="Save" Type="{x:Type p17:CCase}" xmlns:p17="http://aptitudesolutions.com/ShowCaseClassLib">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="CloseReopenChargeWorkflow" Path="Case" />
								</ns0:CallMethodActivity.InstanceObject>
							</ns0:CallMethodActivity>
							<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="SetCaseStatus" MethodName="SetCaseStatus" Type="{x:Type p17:CCase}" xmlns:p17="http://aptitudesolutions.com/ShowCaseClassLib">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="CloseReopenChargeWorkflow" Path="Case" />
								</ns0:CallMethodActivity.InstanceObject>
								<ns0:CallMethodActivity.Parameters>
									<WorkflowParameterBinding ParameterName="pbIncludeCivilCases">
										<WorkflowParameterBinding.Value>
											<ns4:Boolean xmlns:ns4="clr-namespace:System;Assembly=mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">true</ns4:Boolean>
										</WorkflowParameterBinding.Value>
									</WorkflowParameterBinding>
								</ns0:CallMethodActivity.Parameters>
							</ns0:CallMethodActivity>
							<ns0:CallMethodActivity ParameterTypes="{x:Null}" x:Name="RefreshCaseInfo" MethodName="RaiseEvent_RefreshCaseInfo" Type="{x:Type p17:CReopens}" xmlns:p17="http://aptitudesolutions.com/ShowCaseClassLib">
								<ns0:CallMethodActivity.InstanceObject>
									<ActivityBind Name="CloseReopenChargeWorkflow" Path="Case.Reopens" />
								</ns0:CallMethodActivity.InstanceObject>
							</ns0:CallMethodActivity>
						</IfElseBranchActivity>
					</IfElseActivity>
				</IfElseBranchActivity>
			</IfElseActivity>
		</IfElseBranchActivity>
	</IfElseActivity>
</ns0:BaseWorkflow>